
DROP TABLE IF EXISTS `TB_CS_USER`;
DROP TABLE IF EXISTS `TB_CS_ROLE`;
DROP TABLE IF EXISTS `TB_CS_PERMISSION`;
DROP TABLE IF EXISTS `TB_CS_USER_ROLE`;
DROP TABLE IF EXISTS `TB_CS_ROLE_PERMISSION`;


CREATE TABLE `TB_CS_USER` (
  `ID` BIGINT(10) NOT NULL AUTO_INCREMENT,
  `APP_ID` TINYTEXT NOT NULL COMMENT 'APP ID, USER NAME',
  `APP_KEY` TINYTEXT NOT NULL COMMENT 'APP_KEY',
  `APP_SECRET` TINYTEXT NOT NULL COMMENT 'APP_SECRET',
  `BILLING_TYPE_ID` BIGINT(10) DEFAULT NULL COMMENT 'Billing Type ID',
  `STATUS` CHAR(1) NOT NULL DEFAULT 'N' COMMENT 'User Status',
  `CREATE_TIME` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'Create Time',
  `MODIFY_TIME` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'Modify Time',
  `DESCRIPTION` TINYTEXT COMMENT 'User Description',
  PRIMARY KEY (`ID`)
) ENGINE=INNODB DEFAULT CHARSET=utf8;

CREATE TABLE `TB_CS_ROLE` (
  `ID` BIGINT(10) NOT NULL AUTO_INCREMENT,
  `ROLE_NAME` TINYTEXT NOT NULL COMMENT 'Role Name',
  `STATUS` CHAR(1) NOT NULL DEFAULT 'N' COMMENT 'Role Status',
  `CREATE_TIME` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'Create Time',
  `MODIFY_TIME` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'Modify Time',
  `DESCRIPTION` TINYTEXT COMMENT 'User Description',
  PRIMARY KEY (`ID`)
) ENGINE=INNODB DEFAULT CHARSET=utf8;

CREATE TABLE `TB_CS_PERMISSION` (
  `ID` BIGINT(10) NOT NULL AUTO_INCREMENT,
  `URL` TINYTEXT NOT NULL COMMENT 'URL',
  `STATUS` CHAR(1) NOT NULL DEFAULT 'N' COMMENT 'Permission Status',
  `CREATE_TIME` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'Create Time',
  `MODIFY_TIME` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'Modify Time',
  `DESCRIPTION` TINYTEXT COMMENT 'Permission Description',
  PRIMARY KEY (`ID`)
) ENGINE=INNODB DEFAULT CHARSET=utf8;

CREATE TABLE `TB_CS_USER_ROLE` (
  `ID` BIGINT(10) NOT NULL AUTO_INCREMENT,
  `USER_ID` BIGINT(10) NOT NULL COMMENT 'User ID',
  `ROLE_ID` BIGINT(10) NOT NULL COMMENT 'Role ID',
  PRIMARY KEY (`ID`)
) ENGINE=INNODB DEFAULT CHARSET=utf8;

CREATE TABLE `TB_CS_ROLE_PERMISSION` (
  `ID` BIGINT(10) NOT NULL AUTO_INCREMENT,
  `ROLE_ID` BIGINT(10) NOT NULL COMMENT 'Role ID',  
  `PERMISSION_ID` BIGINT(10) NOT NULL COMMENT 'Permission ID',
  PRIMARY KEY (`ID`)
) ENGINE=INNODB DEFAULT CHARSET=utf8;


TRUNCATE TABLE TB_CS_USER;
INSERT INTO TB_CS_USER VALUES (1001, 'admin', 'APP_1001', '123456', 1, 'A', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, 'DESC 1001');
INSERT INTO TB_CS_USER VALUES (1002, 'user', 'APP_1002', '123456', 1, 'A', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, 'DESC 1002');
INSERT INTO TB_CS_USER VALUES (1003, 'GUEST', 'APP_1003', '123456', 1, 'A', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, 'DESC 1003');
COMMIT;
SELECT * FROM TB_CS_USER;

TRUNCATE TABLE TB_CS_ROLE;
INSERT INTO TB_CS_ROLE VALUES (101, 'ROLE_ADMIN', 'A', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, 'Administrator');
INSERT INTO TB_CS_ROLE VALUES (102, 'ROLE_SEARCH', 'A', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, 'Search related function');
INSERT INTO TB_CS_ROLE VALUES (103, 'ROLE_NORMALIZE', 'A', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, 'Normalize related function');
INSERT INTO TB_CS_ROLE VALUES (104, 'ROLE_SEGMENT', 'A', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, 'Segment related function');
COMMIT;
SELECT * FROM TB_CS_ROLE;

INSERT INTO TB_CS_USER_ROLE VALUES (1, 1001, 101);
INSERT INTO TB_CS_USER_ROLE VALUES (2, 1001, 102);
INSERT INTO TB_CS_USER_ROLE VALUES (3, 1001, 103);
INSERT INTO TB_CS_USER_ROLE VALUES (4, 1001, 104);
INSERT INTO TB_CS_USER_ROLE VALUES (5, 1002, 101);
INSERT INTO TB_CS_USER_ROLE VALUES (6, 1002, 102);
INSERT INTO TB_CS_USER_ROLE VALUES (7, 1002, 103);
INSERT INTO TB_CS_USER_ROLE VALUES (8, 1002, 104);
INSERT INTO TB_CS_USER_ROLE VALUES (9, 1003, 102);
COMMIT;
SELECT * FROM TB_CS_USER_ROLE;

SELECT R.* FROM TB_CS_USER U, TB_CS_ROLE R, TB_CS_USER_ROLE UR
 WHERE U.`ID` = UR.`USER_ID` 
   AND R.`ID` = UR.`ROLE_ID`
   AND U.`APP_ID` = 'GUEST';

